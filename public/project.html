<!DOCTYPE html>
<html lang="en" class="app">
<head>
<meta charset="utf-8" />
<title>肠道菌群移植设备管理系统</title>
<meta name="description" content="app, web app, responsive, admin dashboard, admin, flat, flat ui, ui kit, off screen nav" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<link rel="shortcut icon" href="images//logo.png">
<link rel="stylesheet" href="css/app.v2.css" type="text/css" />
<link rel="stylesheet" href="js\calendar/bootstrap_calendar.css" type="text/css" cache="false" />
<link rel="stylesheet" href="css/common.css">
<link rel="stylesheet" href="css/bootstrap-table.css">
<script src="js/jquery-2.1.0.js" cache="false"></script>
<style>
  .addProject{
    width: 500px;
    min-height: 350px;
    position: absolute;
    top: 50%;
    left: 50%;
    margin: -250px 0 0 -250px;
  }
  .changeAdd{
    width: 500px;
    height: 500px;
    position: absolute;
    top: 50%;
    left: 50%;
    margin: -250px 0 0 -250px;
    z-index: 10;
  }
  #mapContent{
    width: 472px;
    height: 400px;
    background-color: aqua;
  }
  .changeAdd button{
    display: block;
    margin: 5px auto 0;
  }
</style>
</head>
<body>
<section class="vbox">
  <!-- 头部 -->
  <header class="bg-dark dk header navbar navbar-fixed-top-xs">
    <div class="navbar-header aside-md" style="width:350px;">
      <a href="#" class="navbar-brand" data-toggle="fullscreen">
        <img src="images/logo.png" class="m-r-sm">
        肠道菌群移植设备管理系统
      </a>
    </div>    
    <ul class="nav navbar-nav navbar-right hidden-xs nav-user">
      <li class="hidden-xs">
        <a href="#" class="dropdown-toggle dk" data-toggle="dropdown">
          <i class="fa fa-bell"></i>
          <span class="badge badge-sm up bg-danger m-l-n-sm count">2</span>
        </a>
        <!-- 报警下拉 -->
        <ul class="dropdown-menu animated fadeInRight">
          <li><a href="#">报警1</a></li>
          <li><a href="#">报警2</a></li>
        </ul>
      </li>      
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
          <span id="userName"></span>
          <b class="caret"></b>
        </a>
        <!-- 用户操作 -->
        <ul class="dropdown-menu animated fadeInRight">
          <li><a href="#" onclick="changeUserInfo()">修改个人信息</a></li>
          <li><a href="#" onclick="changePassword()">修改密码</a></li>
          <li class="divider"></li>
          <li><a href="#" onclick="logout()">退出登录</a></li>
        </ul>
      </li>
    </ul>
  </header>
  <section>
    <section class="hbox stretch">
      <aside class="bg-dark lter aside-md hidden-print" id="nav">
        <section class="vbox">
          <section class="w-f scrollable">
              <div class="slim-scroll" data-height="auto" data-disable-fade-out="true" data-distance="0" data-size="5px" data-color="#333333"> <!-- 导航 -->
              <nav class="nav-primary hidden-xs">
                <ul class="nav">
                  <li><a href="home.html"><i class="fa fa-dashboard icon"><b class="bg-danger"></b></i><span>首页</span></a></li>
                  <li class="active"><a href="#equipment"><i class="fa fa-bell icon"><b class="bg-primary"></b></i><span class="pull-right"><i class="fa fa-angle-down text"></i><i class="fa fa-angle-up text-active"></i></span><span>设备</span></a>
                    <ul class="nav lt">
                      <li class="active"><a href="project.html"><i class="fa fa-angle-right"></i><span>项目</span></a></li>
                      <li><a href="equipment.html"><i class="fa fa-angle-right"></i><span>设备</span></a></li>
                    </ul>
                  </li>
                  <li><a href="consumables.html"><i class="fa fa-flask icon"><b class="bg-success"></b></i><span>耗材</span></a></li>
                  <li><a href="#alarm"><i class="fa fa-bell icon"><b class="bg-primary"></b></i><span class="pull-right"><i class="fa fa-angle-down text"></i><i class="fa fa-angle-up text-active"></i></span><span>报警</span></a>
                    <ul class="nav lt">
                      <li><a href="current_alarm.html"><i class="fa fa-angle-right"></i><span>当前报警</span></a></li>
                      <li><a href="historical_alarm.html"><i class="fa fa-angle-right"></i><span>历史报警</span></a></li>
                    </ul>
                  </li>
                  <li><a href="#statistics"><i class="fa fa-list-ol"><b class="bg-primary dker"></b></i><span class="pull-right"><i class="fa fa-angle-down text"></i><i class="fa fa-angle-up text-active"></i></span><span>统计</span></a>
                    <ul class="nav lt">
                      <li><a href="run_time_statistics.html"><i class="fa fa-angle-right"></i><span>运行时长</span></a></li>
                      <li><a href="equipment_statistics.html"><i class="fa fa-angle-right"></i><span>设备统计</span></a></li>
                      <li><a href="consumable_statistics.html"><i class="fa fa-angle-right"></i><span>耗材统计</span></a></li>
                    </ul>
                  </li>
                  <li><a href="#system"><i class="fa fa-windows"><b class="bg-info"></b></i><span class="pull-right"><i class="fa fa-angle-down text"></i><i class="fa fa-angle-up text-active"></i></span><span>系统</span></a>
                    <ul class="nav lt">
                      <li><a href="user.html"><i class="fa fa-angle-right"></i><span>用户</span></a></li>
                      <li><a href="role.html"><i class="fa fa-angle-right"></i><span>角色</span></a></li>
                      <li><a href="privileges.html"><i class="fa fa-angle-right"></i><span>权限</span></a></li>                  
                    </ul>
                  </li>                  
                </ul>
              </nav>
            </div>
          </section>
          <footer class="footer lt hidden-xs b-t b-dark">            
            <a href="#nav" data-toggle="class:nav-xs" class="pull-right btn btn-sm btn-dark btn-icon"><i class="fa fa-angle-left text"></i><i class="fa fa-angle-right text-active"></i></a>
          </footer>
        </section>
      </aside>
      <!-- 内容 -->
      <section id="content">
        <section class="vbox">
          <div class="opGroup">
            <button class="btn btn-default" onclick="addProject()">添加</button>
            <button class="btn btn-default" onclick="changeProject()">修改</button>
            <button class="btn btn-default" onclick="deleteProject()">删除</button>
          </div>
          <div class="indexTable">
            <table id="indexTable" width="100%"></table>
          </div>
        </section>
    </section>
  </section>
</section>
<div class="mask"></div>
<script src="js/app.v2.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=455d374b510001a6acfcf5bd90367fb2"></script>
<script src="js/bootstrap-table.js"></script>
<script src="js/bootstrap-table-zh-CN.min.js"></script>
<script src="js/tableExport.min.js"></script>
<script src="js/bootstrap-table-export.min.js"></script>
<script src="js/layer/layer.js"></script>
<script src="js/reqDomain.js"></script>
<script src="js/md5.js"></script>
<script src="js/common.js"></script>
<script>
  $(function(){
    getProjectList()
  })
  var tableRow = null
  var lng,lat;
  var address = {
    "0": {
        "110000": "北京",
        "120000": "天津",
        "130000": "河北省",
        "140000": "山西省",
        "150000": "内蒙古自治区",
        "210000": "辽宁省",
        "220000": "吉林省",
        "230000": "黑龙江省",
        "310000": "上海",
        "320000": "江苏省",
        "330000": "浙江省",
        "340000": "安徽省",
        "350000": "福建省",
        "360000": "江西省",
        "370000": "山东省",
        "410000": "河南省",
        "420000": "湖北省",
        "430000": "湖南省",
        "440000": "广东省",
        "450000": "广西壮族自治区",
        "460000": "海南省",
        "500000": "重庆",
        "510000": "四川省",
        "520000": "贵州省",
        "530000": "云南省",
        "540000": "西藏自治区",
        "610000": "陕西省",
        "620000": "甘肃省",
        "630000": "青海省",
        "640000": "宁夏回族自治区",
        "650000": "新疆维吾尔自治区",
        "710000": "台湾省",
        "810000": "香港特别行政区",
        "820000": "澳门特别行政区",
        "990000": "海外"
    },
    "110000": {
        "110100": "北京市"
    },
    "120000": {
        "120100": "天津市"
    },
    "130000": {
        "130100": "石家庄市",
        "130200": "唐山市",
        "130300": "秦皇岛市",
        "130400": "邯郸市",
        "130500": "邢台市",
        "130600": "保定市",
        "130700": "张家口市",
        "130800": "承德市",
        "130900": "沧州市",
        "131000": "廊坊市",
        "131100": "衡水市"
    },
    "140000": {
        "140100": "太原市",
        "140200": "大同市",
        "140300": "阳泉市",
        "140400": "长治市",
        "140500": "晋城市",
        "140600": "朔州市",
        "140700": "晋中市",
        "140800": "运城市",
        "140900": "忻州市",
        "141000": "临汾市",
        "141100": "吕梁市"
    },
    "150000": {
        "150100": "呼和浩特市",
        "150200": "包头市",
        "150300": "乌海市",
        "150400": "赤峰市",
        "150500": "通辽市",
        "150600": "鄂尔多斯市",
        "150700": "呼伦贝尔市",
        "150800": "巴彦淖尔市",
        "150900": "乌兰察布市",
        "152200": "兴安盟",
        "152500": "锡林郭勒盟",
        "152900": "阿拉善盟"
    },
    "210000": {
        "210100": "沈阳市",
        "210200": "大连市",
        "210300": "鞍山市",
        "210400": "抚顺市",
        "210500": "本溪市",
        "210600": "丹东市",
        "210700": "锦州市",
        "210800": "营口市",
        "210900": "阜新市",
        "211000": "辽阳市",
        "211100": "盘锦市",
        "211200": "铁岭市",
        "211300": "朝阳市",
        "211400": "葫芦岛市"
    },
    "220000": {
        "220100": "长春市",
        "220200": "吉林市",
        "220300": "四平市",
        "220400": "辽源市",
        "220500": "通化市",
        "220600": "白山市",
        "220700": "松原市",
        "220800": "白城市",
        "222400": "延边朝鲜族自治州"
    },
    "230000": {
        "230100": "哈尔滨市",
        "230200": "齐齐哈尔市",
        "230300": "鸡西市",
        "230400": "鹤岗市",
        "230500": "双鸭山市",
        "230600": "大庆市",
        "230700": "伊春市",
        "230800": "佳木斯市",
        "230900": "七台河市",
        "231000": "牡丹江市",
        "231100": "黑河市",
        "231200": "绥化市",
        "232700": "大兴安岭地区"
    },
    "320000": {
        "320100": "南京市",
        "320200": "无锡市",
        "320300": "徐州市",
        "320400": "常州市",
        "320500": "苏州市",
        "320600": "南通市",
        "320700": "连云港市",
        "320800": "淮安市",
        "320900": "盐城市",
        "321000": "扬州市",
        "321100": "镇江市",
        "321200": "泰州市",
        "321300": "宿迁市"
    },
    "330000": {
        "330100": "杭州市",
        "330200": "宁波市",
        "330300": "温州市",
        "330400": "嘉兴市",
        "330500": "湖州市",
        "330600": "绍兴市",
        "330700": "金华市",
        "330800": "衢州市",
        "330900": "舟山市",
        "331000": "台州市",
        "331100": "丽水市"
    },
    "340000": {
        "340100": "合肥市",
        "340200": "芜湖市",
        "340300": "蚌埠市",
        "340400": "淮南市",
        "340500": "马鞍山市",
        "340600": "淮北市",
        "340700": "铜陵市",
        "340800": "安庆市",
        "341000": "黄山市",
        "341100": "滁州市",
        "341200": "阜阳市",
        "341300": "宿州市",
        "341500": "六安市",
        "341600": "亳州市",
        "341700": "池州市",
        "341800": "宣城市"
    },
    "360000": {
        "360100": "南昌市",
        "360200": "景德镇市",
        "360300": "萍乡市",
        "360400": "九江市",
        "360500": "新余市",
        "360600": "鹰潭市",
        "360700": "赣州市",
        "360800": "吉安市",
        "360900": "宜春市",
        "361000": "抚州市",
        "361100": "上饶市"
    },
    "370000": {
        "370100": "济南市",
        "370200": "青岛市",
        "370300": "淄博市",
        "370400": "枣庄市",
        "370500": "东营市",
        "370600": "烟台市",
        "370700": "潍坊市",
        "370800": "济宁市",
        "370900": "泰安市",
        "371000": "威海市",
        "371100": "日照市",
        "371200": "莱芜市",
        "371300": "临沂市",
        "371400": "德州市",
        "371500": "聊城市",
        "371600": "滨州市",
        "371700": "菏泽市"
    },
    "410000": {
        "410100": "郑州市",
        "410200": "开封市",
        "410300": "洛阳市",
        "410400": "平顶山市",
        "410500": "安阳市",
        "410600": "鹤壁市",
        "410700": "新乡市",
        "410800": "焦作市",
        "410881": "济源市",
        "410900": "濮阳市",
        "411000": "许昌市",
        "411100": "漯河市",
        "411200": "三门峡市",
        "411300": "南阳市",
        "411400": "商丘市",
        "411500": "信阳市",
        "411600": "周口市",
        "411700": "驻马店市"
    },
    "420000": {
        "420100": "武汉市",
        "420200": "黄石市",
        "420300": "十堰市",
        "420500": "宜昌市",
        "420600": "襄阳市",
        "420700": "鄂州市",
        "420800": "荆门市",
        "420900": "孝感市",
        "421000": "荆州市",
        "421100": "黄冈市",
        "421200": "咸宁市",
        "421300": "随州市",
        "422800": "恩施土家族苗族自治州",
        "429004": "仙桃市",
        "429005": "潜江市",
        "429006": "天门市",
        "429021": "神农架林区"
    },
    "430000": {
        "430100": "长沙市",
        "430200": "株洲市",
        "430300": "湘潭市",
        "430400": "衡阳市",
        "430500": "邵阳市",
        "430600": "岳阳市",
        "430700": "常德市",
        "430800": "张家界市",
        "430900": "益阳市",
        "431000": "郴州市",
        "431100": "永州市",
        "431200": "怀化市",
        "431300": "娄底市",
        "433100": "湘西土家族苗族自治州"
    },
    "440000": {
        "440100": "广州市",
        "440200": "韶关市",
        "440300": "深圳市",
        "440400": "珠海市",
        "440500": "汕头市",
        "440600": "佛山市",
        "440700": "江门市",
        "440800": "湛江市",
        "440900": "茂名市",
        "441200": "肇庆市",
        "441300": "惠州市",
        "441400": "梅州市",
        "441500": "汕尾市",
        "441600": "河源市",
        "441700": "阳江市",
        "441800": "清远市",
        "441900": "东莞市",
        "442000": "中山市",
        "445100": "潮州市",
        "445200": "揭阳市",
        "445300": "云浮市"
    },
    "450000": {
        "450100": "南宁市",
        "450200": "柳州市",
        "450300": "桂林市",
        "450400": "梧州市",
        "450500": "北海市",
        "450600": "防城港市",
        "450700": "钦州市",
        "450800": "贵港市",
        "450900": "玉林市",
        "451000": "百色市",
        "451100": "贺州市",
        "451200": "河池市",
        "451300": "来宾市",
        "451400": "崇左市"
    },
    "510000": {
        "510100": "成都市",
        "510300": "自贡市",
        "510400": "攀枝花市",
        "510500": "泸州市",
        "510600": "德阳市",
        "510700": "绵阳市",
        "510800": "广元市",
        "510900": "遂宁市",
        "511000": "内江市",
        "511100": "乐山市",
        "511300": "南充市",
        "511400": "眉山市",
        "511500": "宜宾市",
        "511600": "广安市",
        "511700": "达州市",
        "511800": "雅安市",
        "511900": "巴中市",
        "512000": "资阳市",
        "513200": "阿坝藏族羌族自治州",
        "513300": "甘孜藏族自治州",
        "513400": "凉山彝族自治州"
    },
    "520000": {
        "520100": "贵阳市",
        "520200": "六盘水市",
        "520300": "遵义市",
        "520400": "安顺市",
        "522200": "铜仁地区",
        "522300": "黔西南布依族苗族自治州",
        "522400": "毕节地区",
        "522600": "黔东南苗族侗族自治州",
        "522700": "黔南布依族苗族自治州"
    },
    "530000": {
        "530100": "昆明市",
        "530300": "曲靖市",
        "530400": "玉溪市",
        "530500": "保山市",
        "530600": "昭通市",
        "530700": "丽江市",
        "530800": "普洱市",
        "530900": "临沧市",
        "532300": "楚雄彝族自治州",
        "532500": "红河哈尼族彝族自治州",
        "532600": "文山壮族苗族自治州",
        "532800": "西双版纳傣族自治州",
        "532900": "大理白族自治州",
        "533100": "德宏傣族景颇族自治州",
        "533300": "怒江傈僳族自治州",
        "533400": "迪庆藏族自治州"
    },
    "540000": {
        "540100": "拉萨市",
        "542100": "昌都地区",
        "542200": "山南地区",
        "542300": "日喀则地区",
        "542400": "那曲地区",
        "542500": "阿里地区",
        "542600": "林芝地区"
    },
    "610000": {
        "610100": "西安市",
        "610200": "铜川市",
        "610300": "宝鸡市",
        "610400": "咸阳市",
        "610500": "渭南市",
        "610600": "延安市",
        "610700": "汉中市",
        "610800": "榆林市",
        "610900": "安康市",
        "611000": "商洛市"
    },
    "620000": {
        "620100": "兰州市",
        "620200": "嘉峪关市",
        "620300": "金昌市",
        "620400": "白银市",
        "620500": "天水市",
        "620600": "武威市",
        "620700": "张掖市",
        "620800": "平凉市",
        "620900": "酒泉市",
        "621000": "庆阳市",
        "621100": "定西市",
        "621200": "陇南市",
        "622900": "临夏回族自治州",
        "623000": "甘南藏族自治州"
    },
    "630000": {
        "630100": "西宁市",
        "632100": "海东地区",
        "632200": "海北藏族自治州",
        "632300": "黄南藏族自治州",
        "632500": "海南藏族自治州",
        "632600": "果洛藏族自治州",
        "632700": "玉树藏族自治州",
        "632800": "海西蒙古族藏族自治州"
    },
    "650000": {
        "650100": "乌鲁木齐市",
        "650200": "克拉玛依市",
        "652100": "吐鲁番地区",
        "652200": "哈密地区",
        "652300": "昌吉回族自治州",
        "652700": "博尔塔拉蒙古自治州",
        "652800": "巴音郭楞蒙古自治州",
        "652900": "阿克苏地区",
        "653000": "克孜勒苏柯尔克孜自治州",
        "653100": "喀什地区",
        "653200": "和田地区",
        "654000": "伊犁哈萨克自治州",
        "654200": "塔城地区",
        "654300": "阿勒泰地区",
        "659001": "石河子市",
        "659002": "阿拉尔市",
        "659003": "图木舒克市",
        "659004": "五家渠市"
    },
    "710000": {
        "710100": "台北市",
        "710200": "高雄市",
        "710300": "台南市",
        "710400": "台中市",
        "710500": "金门县",
        "710600": "南投县",
        "710700": "基隆市",
        "710800": "新竹市",
        "710900": "嘉义市",
        "711100": "新北市",
        "711200": "宜兰县",
        "711300": "新竹县",
        "711400": "桃园县",
        "711500": "苗栗县",
        "711700": "彰化县",
        "711900": "嘉义县",
        "712100": "云林县",
        "712400": "屏东县",
        "712500": "台东县",
        "712600": "花莲县",
        "712700": "澎湖县"
    },
    "810000": {
        "810100": "香港岛",
        "810200": "九龙",
        "810300": "新界"
    },
    "820000": {
        "820100": "澳门半岛",
        "820200": "离岛"
    },
}
  $('#indexTable').bootstrapTable({
    height: document.getElementsByTagName('body')[0].scrollHeight-100,
    clickToSelect: true,
    showColumns: true,
    showExport: true,
    search: true,
    exportDataType: 'all',
    searchTimeOut: 700,
    toolbar: '.opGroup',
    columns: [
      {
        title: '序号',
        formatter: function(value,row,index){
          return index + 1
        }
      },{
        title: '项目名称',
        field: 'name',
      },{
        title: '备注详情',
        field: 'remarks',
      },{
        title:'省份',
        field:'province'
      },{
        title: '城市',
        field: 'city'
      },{
        title: '具体实施地点',
        field: 'address'
      },{
        title: '项目负责人',
        field: 'charge_person'
      },{
        title:'性别',
        field:'gender',
        formatter: function(value){
          return value == 0 ? '男' : '女'
        }
      },{
        title: '电话',
        field: 'tel'
      },{
        title: '邮箱',
        field: 'email'
      }
    ],
    onPostBody:function(){
      var header = $(".fixed-table-header table thead tr th");
      var body = $(".fixed-table-header table tbody tr td");
      var footer = $(".fixed-table-header table tr td");
        body.each(function(){
        header.width((this).width());
        footer.width((this).width());
      });
    }
  })
  $('#indexTable').on('click-row.bs.table',function(e,row,element){
    $(element).addClass('bg').siblings().removeClass('bg');
    tableRow = row;
  })
  // 项目列表
  function getProjectList(){
    $.ajax({
      type: "post",
      url: reqDomain + "/index/project/project_list",
      dataType: "json",
      success: function (data) {
        if(data.code == 200){
          $('#indexTable').bootstrapTable('load',data.result)
        }
      }
    });
  }
  // 添加项目
  function addProject(){
    (function(){
      var str = '<div class="addProject">'+
                '<div class="popover-title">添加项目'+
                  '<button type="button" class="close pullright">&times;</button>'+
                '</div>'+
                '<div class="popover-content">'+
                  '<table>'+                  
                    '<tr>'+
                      '<td>项目名：</td>'+
                      '<td><input type="text" id="name" class="form-control"></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>备注说明：</td>'+
                      '<td><textarea class="form-control" id="remarks"></textarea></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>省市：</td>'+
                      '<td><select class="form-control" id="province">'+
                        '<option>===请选择省份===</option>'+
                        '</select>'+
                        '<select class="form-control" id="city">'+
                          '<option>===请选择城市===</option>'+
                          '</select></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>具体实施地点</td>'+
                      '<td><input type="text" id="address" class="form-control"></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>经纬度</td>'+
                      '<td><input type="text" id="lnglat" disabled class="form-control"></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>获取经纬度</td>'+
                      '<td><button class="btn btn-default" id="showMap">点击获取经纬度</button></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>项目负责人</td>'+
                      '<td><input type="text" id="charge_person" class="form-control"></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>负责人性别：</td>'+
                      '<td><select id="gender" class="form-control">'+
                        '<option value="0">男</option>'+
                        '<option value="1">女</option>'+
                      '</select></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>负责人电话：</td>'+
                      '<td><input type="text" id="tel" class="form-control"></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>负责人邮箱：</td>'+
                      '<td><input type="text" id="email" class="form-control"></td>'+
                    '</tr>'+
                  '</table>'+
                  '<button class="btn btn-default save">保存</button>'+
                '</div>'+
              '</div>';
      $('.mask').show().html(str);
      for(var key in address[0]){
        $('#province').append('<option value="'+key+'">'+address[0][key]+'</option>')
      }
      $('#province').change(function(){
        $('#city option:gt(0)').remove();
        var value = $('#province').val()
        for(var key in address[value]){
          $('#city').append('<option value="'+key+'">'+address[value][key]+'</option>')
        }
      })
    })()
    $('#showMap').click(function(){
      var str = '<div class="changeAdd">'+
                  '<div class="popover-title">点击地图获取经纬度</div>'+
                  '<div class="popover-content">'+
                    '<div id="mapContent"></div>'+
                    '<button class="btn btn-default" id="checkAddr">确定</button>'
                  '</div>'+
                '</div>';
      $('.mask').append(str);
      var map;
      var markClusterer;
      initMap();
      function initMap(){
        map = null;
        map = new BMap.Map('mapContent');
        point = new BMap.Point(101.404,35.917);
        map.centerAndZoom(point, 5);
        map.setMinZoom(0);
        map.enableScrollWheelZoom();
        var top_left_navigation = new BMap.NavigationControl({anchor: BMAP_ANCHOR_TOP_LEFT}); 
        map.addControl(top_left_navigation);
        //清除当前地图内容
        map.clearOverlays();
        window.map = map;
        map.addEventListener('click',function(e){
          lng = e.point.lng;
          lat = e.point.lat;
          map.clearOverlays();
          var pt = new BMap.Point(lng, lat);
          console.log(pt)
          var myIcon = new BMap.Icon("images/addr.png", new BMap.Size(19,50));
          var marker2 = new BMap.Marker(pt,{icon:myIcon});
          map.addOverlay(marker2);          
        })
      }
      $('#checkAddr').click(function(){
        $('.changeAdd').remove();
        $('#lnglat').val(lng.toFixed(8)+','+lat.toFixed(8))
      })
    })
    // 添加保存
    $('.save').click(function(){
      if($('#name').val() == ''){
        layer.msg('项目名不能为空')
      }else if($('#charge_person').val() == ''){
        layer.msg('项目负责人不能为空')
      }else if($('#lnglat').val() == 0){
        layer.msg('项目经纬度不能为空')
      }else{
        $.ajax({
          type: "post",
          url: reqDomain + "/index/project/project_save",
          data: {
            name: $('#name').val(),
            remarks: $('#remarks').val(),
            province: $('#province option:selected').text(),
            city: $('#city option:selected').text(),
            address: $('#address').val(),
            lng: lng,
            lat: lat,
            charge_person: $('#charge_person').val(),
            gender: $('#gender').val(),
            tel: $('#tel').val(),
            email: $('#email').val()
          },
          dataType: "json",
          success: function (data) {
            if(data.code == 200){
              layer.msg('添加成功')
              $('.mask').empty().hide();
              getProjectList()
            }
          }
        });
      }
    })
    // 关闭弹框
    $('.close').click(function(){
      $('.mask').empty().hide()
    })
  }
  // 修改项目
  function changeProject(){
    if(tableRow == null){
      layer.msg('请选择一个项目');
      return false
    }
    (function(){
      var str = '<div class="addProject">'+
                '<div class="popover-title">修改项目'+
                  '<button type="button" class="close pullright">&times;</button>'+
                '</div>'+
                '<div class="popover-content">'+
                  '<table>'+                  
                    '<tr>'+
                      '<td>项目名：</td>'+
                      '<td><input type="text" id="name" class="form-control"></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>备注说明：</td>'+
                      '<td><textarea class="form-control" id="remarks"></textarea></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>省市：</td>'+
                      '<td><select class="form-control" id="province">'+
                        '<option>===请选择省份===</option>'+
                        '</select>'+
                        '<select class="form-control" id="city">'+
                          '<option>===请选择城市===</option>'+
                          '</select></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>具体实施地点</td>'+
                      '<td><input type="text" id="address" class="form-control"></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>经纬度</td>'+
                      '<td><input type="text" id="lnglat" disabled class="form-control"></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>获取经纬度</td>'+
                      '<td><button class="btn btn-default" id="showMap">点击获取经纬度</button></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>项目负责人</td>'+
                      '<td><input type="text" id="charge_person" class="form-control"></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>负责人性别：</td>'+
                      '<td><select id="gender" class="form-control">'+
                        '<option value="0">男</option>'+
                        '<option value="1">女</option>'+
                      '</select></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>负责人电话：</td>'+
                      '<td><input type="text" id="tel" class="form-control"></td>'+
                    '</tr>'+
                    '<tr>'+
                      '<td>负责人邮箱：</td>'+
                      '<td><input type="text" id="email" class="form-control"></td>'+
                    '</tr>'+
                  '</table>'+
                  '<button class="btn btn-default save">保存</button>'+
                '</div>'+
              '</div>';
      $('.mask').show().html(str);
      for(var key in address[0]){
        $('#province').append('<option value="'+key+'">'+address[0][key]+'</option>')
      }
      $('#province').change(function(){
        $('#city option:gt(0)').remove();
        var value = $('#province').val()
        for(var key in address[value]){
          $('#city').append('<option value="'+key+'">'+address[value][key]+'</option>')
        }
      })
      $('#name').val(tableRow.name)
      $('#remarks').val(tableRow.remarks)
      $('#province option').each(function(){
        if($(this).text() == tableRow.province){
          $(this).prop('selected',true)
          $('#province').trigger('change')
        }
      })
      $('#city option').each(function(){
        if($(this).text() == tableRow.city){
          $(this).prop('selected',true)
        }
      })
      $('#lnglat').val(tableRow.lng+','+tableRow.lat)
      lng = tableRow.lng.toFixed(8);
      lat = tableRow.lat.toFixed(8);
      $('#address').val(tableRow.address);
      $('#charge_person').val(tableRow.charge_person)
      $('#gender').val(tableRow.gender)
      $('#tel').val(tableRow.tel)
      $('#email').val(tableRow.email)
    })()
    $('#showMap').click(function(){
      var str = '<div class="changeAdd">'+
                  '<div class="popover-title">点击地图获取经纬度</div>'+
                  '<div class="popover-content">'+
                    '<div id="mapContent"></div>'+
                    '<button class="btn btn-default" id="checkAddr">确定</button>'
                  '</div>'+
                '</div>';
      $('.mask').append(str);
      var map;
      var markClusterer;
      initMap();
      function initMap(){
        map = null;
        map = new BMap.Map('mapContent');
        point = new BMap.Point(101.404,35.917);
        map.centerAndZoom(point, 5);
        map.setMinZoom(0);
        map.enableScrollWheelZoom();
        var top_left_navigation = new BMap.NavigationControl({anchor: BMAP_ANCHOR_TOP_LEFT}); 
        map.addControl(top_left_navigation);
        //清除当前地图内容
        map.clearOverlays();
        window.map = map;
        map.addEventListener('click',function(e){
          console.log(e.point.lng+';'+e.point.lat);
          lng = e.point.lng;
          lat = e.point.lat;
          map.clearOverlays();
          var pt = new BMap.Point(lng, lat);
          var myIcon = new BMap.Icon("images/addr.png", new BMap.Size(19,50));
          var marker2 = new BMap.Marker(pt,{icon:myIcon});
          map.addOverlay(marker2);          
        })
      }
      $('#checkAddr').click(function(){
        $('.changeAdd').remove();
        $('#lnglat').val(lng.toFixed(8)+','+lat.toFixed(8))
      })
    })
    // 修改保存
    $('.save').click(function(){
      if($('#name').val() == ''){
        layer.msg('项目名不能为空')
      }else if($('#charge_person').val() == ''){
        layer.msg('项目负责人不能为空')
      }else if($('#lnglat').val() == 0){
        layer.msg('项目经纬度不能为空')
      }else{
        $.ajax({
          type: "post",
          url: reqDomain + "/index/project/project_save",
          data: {
            id: tableRow.id,
            name: $('#name').val(),
            remarks: $('#remarks').val(),
            province: $('#province option:selected').text(),
            city: $('#city option:selected').text(),
            address: $('#address').val(),
            lng: lng,
            lat: lat,
            charge_person: $('#charge_person').val(),
            gender: $('#gender').val(),
            tel: $('#tel').val(),
            email: $('#email').val()
          },
          dataType: "json",
          success: function (data) {
            if(data.code == 200){
              layer.msg('修改成功')
              tableRow = null;
              $('.mask').empty().hide();
              getProjectList()
            }
          }
        });
      }
    })
    // 关闭弹框
    $('.close').click(function(){
      $('.mask').empty().hide()
    })
  }
  // 删除项目
  function deleteProject(){
    if(tableRow == null){
      layer.msg('请选择一个项目');
      return false
    }
    layer.confirm('确定要删除该项目么？',function(){
      $.ajax({
        type: "post",
        url: reqDomain + "/index/project/project_delete",
        data: {
          id: tableRow.id
        },
        dataType: "json",
        success: function (data) {
          if(data.code == 200){
            layer.msg('删除成功');
            tableRow = null;
            getProjectList()
          }
        }
      });
    })
  }
</script>
</body>
</html>